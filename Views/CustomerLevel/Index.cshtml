@model HealthWellbeing.ViewModels.PaginationInfo<HealthWellbeing.Models.Level>

@{
    ViewData["Title"] = "My Level Progress";

    // Variáveis do Dashboard
    int currentPoints = ViewBag.CurrentPoints;
    int currentLevelNum = ViewBag.CurrentLevelNumber;
    int progress = ViewBag.ProgressPercentage;
    bool isMax = ViewBag.IsMaxLevel;
    int nextLevelNum = ViewBag.NextLevelNumber;
    int pointsNeeded = ViewBag.PointsNeeded;
    int targetPoints = ViewBag.TargetPoints;
}

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - HealthWellbeing</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<div class="container py-5">

    @* --- Cabeçalho --- *@
    <div class="mb-5">
        <h1 class="fw-bold text-dark">My Evolution</h1>
        <p class="text-muted">Track your progress and unlock new tiers.</p>
    </div>

    @* --- DASHBOARD DO TOPO (Mantém-se igual) --- *@
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm rounded-4 h-100 bg-primary text-white overflow-hidden position-relative">
                <div class="card-body p-4 position-relative z-1">
                    <h6 class="text-uppercase opacity-75 fw-bold mb-2">Current Level</h6>
                    <div class="display-3 fw-bold">@currentLevelNum</div>
                    <div class="mt-2 badge bg-white text-primary fw-bold px-3 py-2 rounded-pill">
                        @ViewBag.CategoryName
                    </div>
                </div>
                <i class="bi bi-trophy-fill position-absolute text-white opacity-25" style="font-size: 10rem; right: -20px; bottom: -40px;"></i>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card border-0 shadow-sm rounded-4 h-100 bg-white">
                <div class="card-body p-4 d-flex flex-column justify-content-center">
                    <div class="d-flex justify-content-between align-items-end mb-3">
                        <div>
                            <h5 class="fw-bold text-dark mb-0">Total Score</h5>
                            <span class="text-muted small">Keep completing activities to grow.</span>
                        </div>
                        <div class="text-end">
                            <span class="display-6 fw-bold text-primary">@currentPoints</span>
                            <span class="text-muted"> / @(isMax ? "∞" : targetPoints.ToString()) pts</span>
                        </div>
                    </div>
                    <div class="progress" style="height: 25px; border-radius: 15px; background-color: #f0f2f5;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                             role="progressbar"
                             style="width: @progress%;"
                             aria-valuenow="@progress" aria-valuemin="0" aria-valuemax="100">
                            <span class="fw-bold ms-2">@progress%</span>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        @if (isMax)
                        {
                            <span class="badge bg-warning text-dark px-3 py-2 rounded-pill border">
                                <i class="bi bi-star-fill me-1"></i> Max Level Reached!
                            </span>
                        }
                        else
                        {
                            <span class="text-muted small">
                                Only <strong class="text-dark">@pointsNeeded points</strong> needed to reach <strong class="text-primary">Level @nextLevelNum</strong>!
                            </span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* --- LISTA DE NÍVEIS (ROADMAP) --- *@
    <h4 class="fw-bold text-dark mb-4">Level Roadmap</h4>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-uppercase small text-muted">
                    <tr>
                        <th class="py-3 ps-4 border-0">Level</th>
                        <th class="py-3 border-0">Requirements</th>
                        <th class="py-3 border-0">Category</th>
                        <th class="py-3 border-0">Description</th>
                        <th class="py-3 pe-4 text-end border-0">Status</th>
                    </tr>
                </thead>
                <tbody class="border-top-0">
                    @* Agora usamos Model.Items *@
                    @foreach (var lvl in Model.Items)
                    {
                        bool isPassed = lvl.LevelNumber < currentLevelNum;
                        bool isCurrent = lvl.LevelNumber == currentLevelNum;

                        string rowClass = isCurrent ? "bg-primary bg-opacity-10" : "";

                        <tr class="@rowClass">
                            <td class="ps-4 py-3">
                                <span class="fw-bold fs-5 @(isCurrent ? "text-primary" : "text-dark")">@lvl.LevelNumber</span>
                            </td>
                            <td class="py-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-lightning-charge-fill text-warning me-2"></i>
                                    <span class="fw-medium">@lvl.LevelPointsLimit pts</span>
                                </div>
                            </td>
                            <td class="py-3">
                                <span class="badge bg-light text-dark border rounded-pill">@lvl.Category?.Name</span>
                            </td>
                            <td class="py-3 text-muted small">
                                @lvl.Description
                            </td>
                            <td class="pe-4 text-end py-3">
                                @if (isPassed)
                                {
                                    <i class="bi bi-check-circle-fill text-success fs-5" title="Completed"></i>
                                }
                                else if (isCurrent)
                                {
                                    <span class="badge bg-primary rounded-pill px-3 py-2">Current</span>
                                }
                                else
                                {
                                    <i class="bi bi-lock-fill text-muted opacity-50 fs-5" title="Locked"></i>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @* --- PAGINAÇÃO --- *@
    <div class="d-flex justify-content-center">
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm shadow-sm">
                @* Previous *@
                <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                    <a class="page-link border-0 rounded-start" asp-action="Index" asp-route-page="@(Model.CurrentPage - 1)">Previous</a>
                </li>

                @* Numbers *@
                @for (int p = Model.FirstPageShow; p <= Model.LastPageShow; p++)
                {
                    <li class="page-item @(p == Model.CurrentPage ? "active" : "")">
                        <a class="page-link border-0" asp-action="Index" asp-route-page="@p">@p</a>
                    </li>
                }

                @* Next *@
                <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                    <a class="page-link border-0 rounded-end" asp-action="Index" asp-route-page="@(Model.CurrentPage + 1)">Next</a>
                </li>
            </ul>
        </nav>
    </div>

</div>

<style>
    .page-item.active .page-link {
        background-color: #0d6efd;
        border-color: #0d6efd;
        color: white;
    }

    .page-link {
        color: #333;
    }
</style>