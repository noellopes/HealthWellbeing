@model HealthWellbeing.Models.ViewModels.RegistoCompra

@{
    ViewData["Title"] = "Registo de Encomenda";
}

<div class="container mt-4">

    <!-- TÍTULO -->
    <h2 class="fw-bold text-primary mb-3">
        🧾 Registo de Encomenda
    </h2>

    <p class="text-muted mb-4">
        Selecione o fornecedor para o consumível pretendido, tendo em conta o preço e o tempo de entrega.
    </p>

    <!-- FORM -->
    <form asp-action="ConfirmarRegisto"
          asp-controller="Compra"
          method="post">

        @Html.AntiForgeryToken()

        <!-- CAMPOS ESCONDIDOS OBRIGATÓRIOS -->
        <input type="hidden" asp-for="ConsumivelId" />
        <input type="hidden" asp-for="Quantidade" />

        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">

                <table class="table table-hover align-middle mb-0">
                    <thead style="background-color:#d7e9ff;" class="text-center fw-semibold">
                        <tr>
                            <th style="width:60px;"></th>
                            <th>Fornecedor</th>
                            <th>Preço (€)</th>
                            <th>Tempo de Entrega</th>
                        </tr>
                    </thead>

                    <tbody>
                        @if (Model.Fornecedores == null || !Model.Fornecedores.Any())
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">
                                    Não existem fornecedores associados a este consumível.
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var item in Model.Fornecedores)
                            {
                                <tr class="text-center">
                                    <!-- RADIO -->
                                    <td>
                                        <input class="form-check-input"
                                               type="radio"
                                               name="FornecedorId"
                                               value="@item.FornecedorId"
                                               required />
                                    </td>

                                    <!-- FORNECEDOR -->
                                    <td class="text-start">
                                        🏢 <strong>@item.Fornecedor?.NomeEmpresa</strong>
                                    </td>

                                    <!-- PREÇO -->
                                    <td>
                                        <span class="fw-bold text-success">
                                            @item.Preco.ToString("0.00") €
                                        </span>
                                    </td>

                                    <!-- TEMPO -->
                                    <td>
                                        <span class="badge bg-info text-dark">
                                            ⏱ @(item.TempoEntrega ?? 0) dias
                                        </span>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>

            </div>
        </div>

        <!-- AÇÕES -->
        <div class="d-flex justify-content-between mt-4">
            <a asp-action="Index"
               asp-controller="Stock"
               class="btn btn-outline-secondary px-4">
                ⬅ Voltar
            </a>

            <button type="submit"
                    class="btn btn-success px-5">
                ✅ Confirmar Encomenda
            </button>
        </div>

    </form>

</div>

@section Scripts {
    <script>
        // realçar linha selecionada
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function () {
                document.querySelectorAll('tbody tr')
                    .forEach(tr => tr.classList.remove('table-success'));
                this.closest('tr').classList.add('table-success');
            });
        });
    </script>
}
