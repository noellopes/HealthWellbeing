@model IEnumerable<HealthWellbeingRoom.Models.RoomReservation>

@{
    ViewData["Title"] = "Reservas de Salas";

    bool isAdmin = User.IsInRole("Administrator");
    bool isLogTech = User.IsInRole("logisticsTechnician");
}

<h1 class="mb-4 text-success">
    <i class="bi bi-calendar-check me-2"></i> Lista das reservas de Salas
</h1>

@if (isLogTech)
{
    <div class="mb-3 text-end">
        <a asp-action="Create" class="btn btn-success btn-sm" style="min-width:150px">
            <i class="bi bi-plus-circle me-1"></i> Nova Reserva
        </a>
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="card shadow-sm">
    <div class="card-body">

        @if (!Model.Any())
        {
            <div class="alert alert-info text-center">
                Ainda não há reservas de salas.
            </div>
        }
        else
        {
            <table class="table">
                <thead>
                    <tr>
                        <th>Id da reserva</th>
                        <th>Id da consulta</th>
                        <th>Responsável</th>
                        <th>Sala</th>
                        <th>Início</th>
                        <th>Fim</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.RoomReservationId.ToString("D3")</td>
                            <td>@item.ConsultationId.ToString("D3")</td>
                            <td>@(string.IsNullOrWhiteSpace(item.ResponsibleName) ? "—" : item.ResponsibleName)</td>
                            <td>@(item.Room?.Name ?? "—")</td>
                            <td>@(item.StartTime == default ? "—" : item.StartTime.ToString("g"))</td>
                            <td>@(item.EndTime == default ? "—" : item.EndTime.ToString("g"))</td>

                            <td class="text-center">

                                @if (isLogTech)
                                {
                                    <a asp-action="Edit"
                                       asp-route-id="@item.RoomReservationId"
                                       class="btn btn-sm btn-warning me-1">
                                        <i class="bi bi-pencil-square"></i> Editar
                                    </a>
                                }

                                <a asp-action="Details"
                                   asp-route-id="@item.RoomReservationId"
                                   asp-route-fromCreation="false"
                                   class="btn btn-sm btn-info me-1">
                                    <i class="bi bi-info-circle-fill"></i> Detalhes
                                </a>

                                @if (isLogTech)
                                {
                                    <a asp-action="Delete"
                                       asp-route-id="@item.RoomReservationId"
                                       class="btn btn-sm btn-danger me-1">
                                        <i class="bi bi-trash-fill"></i> Cancelar
                                    </a>
                                }

                                @if (isLogTech)
                                {
                                    <form asp-action="MarcarComoRealizada"
                                          asp-route-id="@item.RoomReservationId"
                                          method="post"
                                          style="display:inline;">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-success me-1">
                                            <i class="bi bi-check-circle-fill"></i> Realizada?
                                        </button>
                                    </form>
                                }

                                <a asp-controller="RoomReservations"
                                    asp-action="RoomMaterials"
                                   asp-route-Id="@item.RoomId"
                                   class="btn btn-sm btn-warning">
                                    <i class="bi bi-box-seam"></i> Material
                                </a>

                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }

    </div>
</div>

<div class="mt-4 text-end">

    <a asp-controller="Rooms"
       asp-action="Index"
       class="btn btn-success btn-sm me-2">
        <i class="bi bi-door-open-fill me-1"></i> Ver Lista de Salas
    </a>

    <a asp-controller="RoomReservations"
       asp-action="Consultation"
       class="btn btn-success btn-sm">
        <i class="bi bi-people-fill me-1"></i> Ver Lista de Consultas
    </a>

</div>
